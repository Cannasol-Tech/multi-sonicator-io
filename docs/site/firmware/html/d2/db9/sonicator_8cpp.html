<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Multi-Sonicator IO Firmware: src/modules/control/sonicator.cpp File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Multi-Sonicator IO Firmware
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('d2/db9/sonicator_8cpp.html','../../',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">sonicator.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Single Sonicator Control Implementation for Epic 1 Story 1.4.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../de/d13/sonicator__control_8h_source.html">sonicator_control.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/d16/config_8h_source.html">config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d6/d7c/gpio_8h_source.html">modules/hal/gpio.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d6/db9/pwm_8h_source.html">modules/hal/pwm.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d7/d19/adc_8h_source.html">modules/hal/adc.h</a>&quot;</code><br />
<code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a0b7077f739992ab6c25eb7d02c0899c6" id="r_a0b7077f739992ab6c25eb7d02c0899c6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0b7077f739992ab6c25eb7d02c0899c6">SONICATOR_SIMULATION_MODE</a>&#160;&#160;&#160;0</td></tr>
<tr class="memitem:a9b3ce32f980a7abc4dfdbe110f665c8d" id="r_a9b3ce32f980a7abc4dfdbe110f665c8d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9b3ce32f980a7abc4dfdbe110f665c8d">SONICATOR_LOG</a>(msg)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab73283b0ecebb62fc40528dd0117b5fe" id="r_ab73283b0ecebb62fc40528dd0117b5fe"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab73283b0ecebb62fc40528dd0117b5fe">get_timestamp_ms</a> (void)</td></tr>
<tr class="memdesc:ab73283b0ecebb62fc40528dd0117b5fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get current system timestamp in milliseconds.  <br /></td></tr>
<tr class="memitem:ad64f181378aff681db9d4113aa0b5a7c" id="r_ad64f181378aff681db9d4113aa0b5a7c"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad64f181378aff681db9d4113aa0b5a7c">is_timeout</a> (uint32_t start_time, uint32_t timeout_ms)</td></tr>
<tr class="memdesc:ad64f181378aff681db9d4113aa0b5a7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if timeout period has elapsed.  <br /></td></tr>
<tr class="memitem:ab8a2aa3f7760758e71971579d8cacaad" id="r_ab8a2aa3f7760758e71971579d8cacaad"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab8a2aa3f7760758e71971579d8cacaad">clamp_amplitude</a> (uint8_t amplitude)</td></tr>
<tr class="memdesc:ab8a2aa3f7760758e71971579d8cacaad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clamp amplitude to valid range (20-100%)  <br /></td></tr>
<tr class="memitem:a0e114d879aa3d9d4769514bf9552d4b5" id="r_a0e114d879aa3d9d4769514bf9552d4b5"><td class="memItemLeft" align="right" valign="top">static uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0e114d879aa3d9d4769514bf9552d4b5">amplitude_to_pwm</a> (uint8_t amplitude_percent)</td></tr>
<tr class="memdesc:a0e114d879aa3d9d4769514bf9552d4b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert amplitude percentage to PWM duty cycle.  <br /></td></tr>
<tr class="memitem:ac63cfc1531dfd81f9b26907f6cfca3f3" id="r_ac63cfc1531dfd81f9b26907f6cfca3f3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac63cfc1531dfd81f9b26907f6cfca3f3">hal_gpio_write_safe</a> (uint8_t pin, bool state)</td></tr>
<tr class="memdesc:ac63cfc1531dfd81f9b26907f6cfca3f3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write GPIO pin with simulation mode support.  <br /></td></tr>
<tr class="memitem:a44f746b3b6005ab7712fa07bbabce3b5" id="r_a44f746b3b6005ab7712fa07bbabce3b5"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a44f746b3b6005ab7712fa07bbabce3b5">hal_gpio_read_safe</a> (uint8_t pin)</td></tr>
<tr class="memdesc:a44f746b3b6005ab7712fa07bbabce3b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read GPIO pin with simulation mode support.  <br /></td></tr>
<tr class="memitem:aeee6577caee2ab0b3abebc40d69e3ecf" id="r_aeee6577caee2ab0b3abebc40d69e3ecf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeee6577caee2ab0b3abebc40d69e3ecf">hal_pwm_set_safe</a> (uint8_t pin, uint8_t duty_cycle)</td></tr>
<tr class="memdesc:aeee6577caee2ab0b3abebc40d69e3ecf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set PWM duty cycle with simulation mode support.  <br /></td></tr>
<tr class="memitem:a0970e247ed7903117ae0390646f38772" id="r_a0970e247ed7903117ae0390646f38772"><td class="memItemLeft" align="right" valign="top">static uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a0970e247ed7903117ae0390646f38772">hal_adc_read_safe</a> (<a class="el" href="../../d7/d19/adc_8h.html#aafc4060027875f8fe46242b0656d7814">adc_channel_t</a> channel)</td></tr>
<tr class="memdesc:a0970e247ed7903117ae0390646f38772"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read ADC channel with simulation mode support.  <br /></td></tr>
<tr class="memitem:ada89ba9b127e4beefebcf0437c3d3706" id="r_ada89ba9b127e4beefebcf0437c3d3706"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ada89ba9b127e4beefebcf0437c3d3706">update_hardware_outputs</a> (void)</td></tr>
<tr class="memdesc:ada89ba9b127e4beefebcf0437c3d3706"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update hardware outputs based on current state.  <br /></td></tr>
<tr class="memitem:aef16074da149c14e5667730099c3cd1e" id="r_aef16074da149c14e5667730099c3cd1e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aef16074da149c14e5667730099c3cd1e">read_hardware_inputs</a> (void)</td></tr>
<tr class="memdesc:aef16074da149c14e5667730099c3cd1e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read hardware inputs and update status.  <br /></td></tr>
<tr class="memitem:a3e5dff7d739c31be62ed6a2517a3101d" id="r_a3e5dff7d739c31be62ed6a2517a3101d"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../de/d13/sonicator__control_8h.html#a361c37dbeedf89f2fe09845eab7f0a99">sonicator_fault_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3e5dff7d739c31be62ed6a2517a3101d">check_fault_conditions</a> (void)</td></tr>
<tr class="memdesc:a3e5dff7d739c31be62ed6a2517a3101d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check for fault conditions.  <br /></td></tr>
<tr class="memitem:a98449ff464a0585638878fb00728a7fd" id="r_a98449ff464a0585638878fb00728a7fd"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a98449ff464a0585638878fb00728a7fd">handle_fault_conditions</a> (<a class="el" href="../../de/d13/sonicator__control_8h.html#a361c37dbeedf89f2fe09845eab7f0a99">sonicator_fault_t</a> faults)</td></tr>
<tr class="memdesc:a98449ff464a0585638878fb00728a7fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle fault detection and emergency stop.  <br /></td></tr>
<tr class="memitem:a5899c8af8472545d64087e08378b2a29" id="r_a5899c8af8472545d64087e08378b2a29"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5899c8af8472545d64087e08378b2a29">process_state_machine</a> (void)</td></tr>
<tr class="memdesc:a5899c8af8472545d64087e08378b2a29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process state machine transitions.  <br /></td></tr>
<tr class="memitem:ac88614577067020f420441ba689e7241" id="r_ac88614577067020f420441ba689e7241"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac88614577067020f420441ba689e7241">sonicator_begin</a> (void)</td></tr>
<tr class="memdesc:ac88614577067020f420441ba689e7241"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize sonicator control system.  <br /></td></tr>
<tr class="memitem:aab49fb783e216647f53db17fbb6b62b1" id="r_aab49fb783e216647f53db17fbb6b62b1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aab49fb783e216647f53db17fbb6b62b1">sonicator_start</a> (void)</td></tr>
<tr class="memdesc:aab49fb783e216647f53db17fbb6b62b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start sonicator operation.  <br /></td></tr>
<tr class="memitem:a4c28efedf324a8f71669e203de81ca47" id="r_a4c28efedf324a8f71669e203de81ca47"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4c28efedf324a8f71669e203de81ca47">sonicator_stop</a> (void)</td></tr>
<tr class="memdesc:a4c28efedf324a8f71669e203de81ca47"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop sonicator operation.  <br /></td></tr>
<tr class="memitem:ad48d366d35d3f9fc640589b2b5623aa2" id="r_ad48d366d35d3f9fc640589b2b5623aa2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad48d366d35d3f9fc640589b2b5623aa2">sonicator_set_amplitude</a> (uint8_t amplitude_percent)</td></tr>
<tr class="memdesc:ad48d366d35d3f9fc640589b2b5623aa2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set sonicator amplitude.  <br /></td></tr>
<tr class="memitem:a21c76fda64cb8f4ddaf2f55f3567ec5e" id="r_a21c76fda64cb8f4ddaf2f55f3567ec5e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a21c76fda64cb8f4ddaf2f55f3567ec5e">sonicator_reset_overload</a> (void)</td></tr>
<tr class="memdesc:a21c76fda64cb8f4ddaf2f55f3567ec5e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset overload condition.  <br /></td></tr>
<tr class="memitem:a626ecb2d4d66e32401478259cfe3595f" id="r_a626ecb2d4d66e32401478259cfe3595f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a626ecb2d4d66e32401478259cfe3595f">sonicator_emergency_stop</a> (void)</td></tr>
<tr class="memdesc:a626ecb2d4d66e32401478259cfe3595f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Emergency stop (immediate)  <br /></td></tr>
<tr class="memitem:adfd3a8b6450a1a09bf17d4865c32569c" id="r_adfd3a8b6450a1a09bf17d4865c32569c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../de/d13/sonicator__control_8h.html#ad0aeab8703f3a1439806186cba759315">sonicator_state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adfd3a8b6450a1a09bf17d4865c32569c">sonicator_update</a> (void)</td></tr>
<tr class="memdesc:adfd3a8b6450a1a09bf17d4865c32569c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Main control update function.  <br /></td></tr>
<tr class="memitem:a1ecfcd93a4b2bd32c9cab9f359b831ba" id="r_a1ecfcd93a4b2bd32c9cab9f359b831ba"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="../../df/d70/structsonicator__state__control__t.html">sonicator_state_control_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1ecfcd93a4b2bd32c9cab9f359b831ba">sonicator_get_status</a> (void)</td></tr>
<tr class="memdesc:a1ecfcd93a4b2bd32c9cab9f359b831ba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get current sonicator status.  <br /></td></tr>
<tr class="memitem:abe828539c1f97df3497b972c3c72c75f" id="r_abe828539c1f97df3497b972c3c72c75f"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abe828539c1f97df3497b972c3c72c75f">sonicator_state_to_string</a> (<a class="el" href="../../de/d13/sonicator__control_8h.html#ad0aeab8703f3a1439806186cba759315">sonicator_state_t</a> state)</td></tr>
<tr class="memdesc:abe828539c1f97df3497b972c3c72c75f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get current state as string (for debugging)  <br /></td></tr>
<tr class="memitem:a2309ace8e76b3132b8b2f0e7d0df9956" id="r_a2309ace8e76b3132b8b2f0e7d0df9956"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2309ace8e76b3132b8b2f0e7d0df9956">sonicator_is_safe</a> (void)</td></tr>
<tr class="memdesc:a2309ace8e76b3132b8b2f0e7d0df9956"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if sonicator is in safe state.  <br /></td></tr>
<tr class="memitem:a85b84eadaf4c625391673e214901144f" id="r_a85b84eadaf4c625391673e214901144f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a85b84eadaf4c625391673e214901144f">sonicator_reset_statistics</a> (void)</td></tr>
<tr class="memdesc:a85b84eadaf4c625391673e214901144f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset all statistics and counters.  <br /></td></tr>
<tr class="memitem:a4519e53de39614ddb883a4c2db06ea19" id="r_a4519e53de39614ddb883a4c2db06ea19"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4519e53de39614ddb883a4c2db06ea19">sonicator_force_state</a> (<a class="el" href="../../de/d13/sonicator__control_8h.html#ad0aeab8703f3a1439806186cba759315">sonicator_state_t</a> new_state)</td></tr>
<tr class="memdesc:a4519e53de39614ddb883a4c2db06ea19"><td class="mdescLeft">&#160;</td><td class="mdescRight">Force state transition (testing only)  <br /></td></tr>
<tr class="memitem:a79b77d91a6416dd0447f9c6c9741ec36" id="r_a79b77d91a6416dd0447f9c6c9741ec36"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a79b77d91a6416dd0447f9c6c9741ec36">sonicator_inject_fault</a> (<a class="el" href="../../de/d13/sonicator__control_8h.html#a361c37dbeedf89f2fe09845eab7f0a99">sonicator_fault_t</a> fault_mask)</td></tr>
<tr class="memdesc:a79b77d91a6416dd0447f9c6c9741ec36"><td class="mdescLeft">&#160;</td><td class="mdescRight">Inject fault condition (testing only)  <br /></td></tr>
<tr class="memitem:abe9ba511a647d9236e12897ce8cf7271" id="r_abe9ba511a647d9236e12897ce8cf7271"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abe9ba511a647d9236e12897ce8cf7271">sonicator_set_simulation_mode</a> (bool enable)</td></tr>
<tr class="memdesc:abe9ba511a647d9236e12897ce8cf7271"><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable/disable simulation mode.  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a2bc3fad78fedc5ae0e007a5cc4485108" id="r_a2bc3fad78fedc5ae0e007a5cc4485108"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="../../df/d70/structsonicator__state__control__t.html">sonicator_state_control_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2bc3fad78fedc5ae0e007a5cc4485108">g_sonicator</a></td></tr>
<tr class="memitem:ac1fd48a035e83d4c49c15569676b3428" id="r_ac1fd48a035e83d4c49c15569676b3428"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac1fd48a035e83d4c49c15569676b3428">g_simulation_mode</a> = <a class="el" href="#a0b7077f739992ab6c25eb7d02c0899c6">SONICATOR_SIMULATION_MODE</a></td></tr>
<tr class="memitem:ae51dbc7e8f836d942c158d75aa6e345b" id="r_ae51dbc7e8f836d942c158d75aa6e345b"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae51dbc7e8f836d942c158d75aa6e345b">g_initialized</a> = false</td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Single Sonicator Control Implementation for Epic 1 Story 1.4. </p>
<dl class="section author"><dt>Author</dt><dd>Cannasol Technologies <br  />
 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2025-09-12 </dd></dl>
<dl class="section version"><dt>Version</dt><dd>1.0.0</dd></dl>
<p>Implementation of single sonicator control logic with state machine, safety monitoring, and HAL integration. Designed for Sonicator 4 (zero-based ID 3) per pin matrix configuration.</p>
<p>Features:</p><ul>
<li>Non-blocking state machine for 1kHz execution</li>
<li>Hardware abstraction via HAL interfaces <br  />
</li>
<li>Safety monitoring with fault detection</li>
<li>MODBUS register integration ready</li>
<li>Comprehensive error handling and recovery </li>
</ul>
</div><a name="doc-define-members" id="doc-define-members"></a><h2 id="header-doc-define-members" class="groupheader">Macro Definition Documentation</h2>
<a id="a9b3ce32f980a7abc4dfdbe110f665c8d" name="a9b3ce32f980a7abc4dfdbe110f665c8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b3ce32f980a7abc4dfdbe110f665c8d">&#9670;&#160;</a></span>SONICATOR_LOG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONICATOR_LOG</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>msg</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">((void)0)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a0b7077f739992ab6c25eb7d02c0899c6" name="a0b7077f739992ab6c25eb7d02c0899c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b7077f739992ab6c25eb7d02c0899c6">&#9670;&#160;</a></span>SONICATOR_SIMULATION_MODE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define SONICATOR_SIMULATION_MODE&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a0e114d879aa3d9d4769514bf9552d4b5" name="a0e114d879aa3d9d4769514bf9552d4b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e114d879aa3d9d4769514bf9552d4b5">&#9670;&#160;</a></span>amplitude_to_pwm()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t amplitude_to_pwm </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>amplitude_percent</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Convert amplitude percentage to PWM duty cycle. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">amplitude_percent</td><td>Amplitude (20-100%) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PWM value (0-255) </dd></dl>

</div>
</div>
<a id="a3e5dff7d739c31be62ed6a2517a3101d" name="a3e5dff7d739c31be62ed6a2517a3101d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e5dff7d739c31be62ed6a2517a3101d">&#9670;&#160;</a></span>check_fault_conditions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/d13/sonicator__control_8h.html#a361c37dbeedf89f2fe09845eab7f0a99">sonicator_fault_t</a> check_fault_conditions </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check for fault conditions. </p>
<dl class="section return"><dt>Returns</dt><dd>Active fault mask </dd></dl>

</div>
</div>
<a id="ab8a2aa3f7760758e71971579d8cacaad" name="ab8a2aa3f7760758e71971579d8cacaad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8a2aa3f7760758e71971579d8cacaad">&#9670;&#160;</a></span>clamp_amplitude()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t clamp_amplitude </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>amplitude</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Clamp amplitude to valid range (20-100%) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">amplitude</td><td>Input amplitude </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Clamped amplitude </dd></dl>

</div>
</div>
<a id="ab73283b0ecebb62fc40528dd0117b5fe" name="ab73283b0ecebb62fc40528dd0117b5fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab73283b0ecebb62fc40528dd0117b5fe">&#9670;&#160;</a></span>get_timestamp_ms()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t get_timestamp_ms </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get current system timestamp in milliseconds. </p>
<dl class="section return"><dt>Returns</dt><dd>Current timestamp </dd></dl>

</div>
</div>
<a id="a0970e247ed7903117ae0390646f38772" name="a0970e247ed7903117ae0390646f38772"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0970e247ed7903117ae0390646f38772">&#9670;&#160;</a></span>hal_adc_read_safe()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t hal_adc_read_safe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d7/d19/adc_8h.html#aafc4060027875f8fe46242b0656d7814">adc_channel_t</a></td>          <td class="paramname"><span class="paramname"><em>channel</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read ADC channel with simulation mode support. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channel</td><td>ADC channel </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ADC value (0-1023) </dd></dl>

</div>
</div>
<a id="a44f746b3b6005ab7712fa07bbabce3b5" name="a44f746b3b6005ab7712fa07bbabce3b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44f746b3b6005ab7712fa07bbabce3b5">&#9670;&#160;</a></span>hal_gpio_read_safe()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool hal_gpio_read_safe </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>pin</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read GPIO pin with simulation mode support. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pin</td><td>Pin identifier </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pin state (true=HIGH, false=LOW) </dd></dl>

</div>
</div>
<a id="ac63cfc1531dfd81f9b26907f6cfca3f3" name="ac63cfc1531dfd81f9b26907f6cfca3f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac63cfc1531dfd81f9b26907f6cfca3f3">&#9670;&#160;</a></span>hal_gpio_write_safe()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void hal_gpio_write_safe </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>pin</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>state</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Write GPIO pin with simulation mode support. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pin</td><td>Pin identifier <br  />
 </td></tr>
    <tr><td class="paramname">state</td><td>Pin state (true=HIGH, false=LOW) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aeee6577caee2ab0b3abebc40d69e3ecf" name="aeee6577caee2ab0b3abebc40d69e3ecf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeee6577caee2ab0b3abebc40d69e3ecf">&#9670;&#160;</a></span>hal_pwm_set_safe()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void hal_pwm_set_safe </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>pin</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>duty_cycle</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set PWM duty cycle with simulation mode support. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pin</td><td>PWM pin identifier </td></tr>
    <tr><td class="paramname">duty_cycle</td><td>Duty cycle (0-255) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a98449ff464a0585638878fb00728a7fd" name="a98449ff464a0585638878fb00728a7fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a98449ff464a0585638878fb00728a7fd">&#9670;&#160;</a></span>handle_fault_conditions()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void handle_fault_conditions </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d13/sonicator__control_8h.html#a361c37dbeedf89f2fe09845eab7f0a99">sonicator_fault_t</a></td>          <td class="paramname"><span class="paramname"><em>faults</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Handle fault detection and emergency stop. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">faults</td><td>Active fault conditions </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ad64f181378aff681db9d4113aa0b5a7c" name="ad64f181378aff681db9d4113aa0b5a7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad64f181378aff681db9d4113aa0b5a7c">&#9670;&#160;</a></span>is_timeout()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool is_timeout </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>start_time</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>timeout_ms</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if timeout period has elapsed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">start_time</td><td>Start timestamp </td></tr>
    <tr><td class="paramname">timeout_ms</td><td>Timeout period in milliseconds <br  />
 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if timeout elapsed </dd></dl>

</div>
</div>
<a id="a5899c8af8472545d64087e08378b2a29" name="a5899c8af8472545d64087e08378b2a29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5899c8af8472545d64087e08378b2a29">&#9670;&#160;</a></span>process_state_machine()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void process_state_machine </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Process state machine transitions. </p>

</div>
</div>
<a id="aef16074da149c14e5667730099c3cd1e" name="aef16074da149c14e5667730099c3cd1e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef16074da149c14e5667730099c3cd1e">&#9670;&#160;</a></span>read_hardware_inputs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void read_hardware_inputs </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read hardware inputs and update status. </p>

</div>
</div>
<a id="ac88614577067020f420441ba689e7241" name="ac88614577067020f420441ba689e7241"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac88614577067020f420441ba689e7241">&#9670;&#160;</a></span>sonicator_begin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sonicator_begin </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize sonicator control system. </p>
<p>Sets up state machine, HAL interfaces, and safety systems. Must be called before any other sonicator control functions.</p>
<dl class="section return"><dt>Returns</dt><dd>true if initialization successful, false on error </dd></dl>

</div>
</div>
<a id="a626ecb2d4d66e32401478259cfe3595f" name="a626ecb2d4d66e32401478259cfe3595f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a626ecb2d4d66e32401478259cfe3595f">&#9670;&#160;</a></span>sonicator_emergency_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sonicator_emergency_stop </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Emergency stop (immediate) </p>
<p>Immediately stops sonicator regardless of current state. Used for safety-critical situations.</p>
<dl class="section return"><dt>Returns</dt><dd>true always (cannot fail) </dd></dl>

</div>
</div>
<a id="a4519e53de39614ddb883a4c2db06ea19" name="a4519e53de39614ddb883a4c2db06ea19"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4519e53de39614ddb883a4c2db06ea19">&#9670;&#160;</a></span>sonicator_force_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sonicator_force_state </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d13/sonicator__control_8h.html#ad0aeab8703f3a1439806186cba759315">sonicator_state_t</a></td>          <td class="paramname"><span class="paramname"><em>new_state</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Force state transition (testing only) </p>
<p><b>WARNING</b>: Bypasses safety checks. Use only for unit testing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">new_state</td><td>Target state </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if transition completed </dd></dl>

</div>
</div>
<a id="a1ecfcd93a4b2bd32c9cab9f359b831ba" name="a1ecfcd93a4b2bd32c9cab9f359b831ba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ecfcd93a4b2bd32c9cab9f359b831ba">&#9670;&#160;</a></span>sonicator_get_status()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="../../df/d70/structsonicator__state__control__t.html">sonicator_state_control_t</a> * sonicator_get_status </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get current sonicator status. </p>
<p>Returns complete sonicator status structure for MODBUS or diagnostics. Safe to call from any context.</p>
<dl class="section return"><dt>Returns</dt><dd>Pointer to current status structure (read-only) </dd></dl>

</div>
</div>
<a id="a79b77d91a6416dd0447f9c6c9741ec36" name="a79b77d91a6416dd0447f9c6c9741ec36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79b77d91a6416dd0447f9c6c9741ec36">&#9670;&#160;</a></span>sonicator_inject_fault()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sonicator_inject_fault </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d13/sonicator__control_8h.html#a361c37dbeedf89f2fe09845eab7f0a99">sonicator_fault_t</a></td>          <td class="paramname"><span class="paramname"><em>fault_mask</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Inject fault condition (testing only) </p>
<p><b>WARNING</b>: For testing only. Injects artificial fault condition.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fault_mask</td><td>Fault condition to inject </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if fault injected </dd></dl>

</div>
</div>
<a id="a2309ace8e76b3132b8b2f0e7d0df9956" name="a2309ace8e76b3132b8b2f0e7d0df9956"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2309ace8e76b3132b8b2f0e7d0df9956">&#9670;&#160;</a></span>sonicator_is_safe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sonicator_is_safe </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if sonicator is in safe state. </p>
<p>Verifies all safety conditions are met:</p><ul>
<li>No active faults</li>
<li>Watchdog not expired</li>
<li>Communication active</li>
<li>Hardware responding</li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>true if safe, false if safety concern exists </dd></dl>

</div>
</div>
<a id="a21c76fda64cb8f4ddaf2f55f3567ec5e" name="a21c76fda64cb8f4ddaf2f55f3567ec5e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21c76fda64cb8f4ddaf2f55f3567ec5e">&#9670;&#160;</a></span>sonicator_reset_overload()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sonicator_reset_overload </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset overload condition. </p>
<p>Sends reset pulse to clear overload fault condition. Only effective when sonicator is in FAULT state due to overload.</p>
<dl class="section return"><dt>Returns</dt><dd>true if reset command sent, false if not applicable </dd></dl>

</div>
</div>
<a id="a85b84eadaf4c625391673e214901144f" name="a85b84eadaf4c625391673e214901144f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a85b84eadaf4c625391673e214901144f">&#9670;&#160;</a></span>sonicator_reset_statistics()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sonicator_reset_statistics </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset all statistics and counters. </p>
<p>Clears runtime counters, fault counts, and statistics. Does not affect current operational state. </p>

</div>
</div>
<a id="ad48d366d35d3f9fc640589b2b5623aa2" name="ad48d366d35d3f9fc640589b2b5623aa2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad48d366d35d3f9fc640589b2b5623aa2">&#9670;&#160;</a></span>sonicator_set_amplitude()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sonicator_set_amplitude </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>amplitude_percent</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set sonicator amplitude. </p>
<p>Sets amplitude setpoint for sonicator operation. Valid range: 20-100% (CT2000 specification)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">amplitude_percent</td><td>Amplitude setting (20-100%) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if amplitude set successfully, false if out of range </dd></dl>

</div>
</div>
<a id="abe9ba511a647d9236e12897ce8cf7271" name="abe9ba511a647d9236e12897ce8cf7271"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe9ba511a647d9236e12897ce8cf7271">&#9670;&#160;</a></span>sonicator_set_simulation_mode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sonicator_set_simulation_mode </td>
          <td>(</td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>enable</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Enable/disable simulation mode. </p>
<p>When enabled, bypasses HAL calls for unit testing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">enable</td><td>true to enable simulation, false for normal operation </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aab49fb783e216647f53db17fbb6b62b1" name="aab49fb783e216647f53db17fbb6b62b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab49fb783e216647f53db17fbb6b62b1">&#9670;&#160;</a></span>sonicator_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sonicator_start </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start sonicator operation. </p>
<p>Commands sonicator to start with current amplitude setting. State transition: IDLE → STARTING → RUNNING</p>
<dl class="section return"><dt>Returns</dt><dd>true if start command accepted, false if unable to start </dd></dl>

</div>
</div>
<a id="abe828539c1f97df3497b972c3c72c75f" name="abe828539c1f97df3497b972c3c72c75f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abe828539c1f97df3497b972c3c72c75f">&#9670;&#160;</a></span>sonicator_state_to_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * sonicator_state_to_string </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../de/d13/sonicator__control_8h.html#ad0aeab8703f3a1439806186cba759315">sonicator_state_t</a></td>          <td class="paramname"><span class="paramname"><em>state</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get current state as string (for debugging) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>State to convert </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>String representation of state </dd></dl>

</div>
</div>
<a id="a4c28efedf324a8f71669e203de81ca47" name="a4c28efedf324a8f71669e203de81ca47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c28efedf324a8f71669e203de81ca47">&#9670;&#160;</a></span>sonicator_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool sonicator_stop </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop sonicator operation. </p>
<p>Commands sonicator to stop gracefully. State transition: RUNNING → STOPPING → IDLE</p>
<dl class="section return"><dt>Returns</dt><dd>true if stop command accepted, false if already stopped </dd></dl>

</div>
</div>
<a id="adfd3a8b6450a1a09bf17d4865c32569c" name="adfd3a8b6450a1a09bf17d4865c32569c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adfd3a8b6450a1a09bf17d4865c32569c">&#9670;&#160;</a></span>sonicator_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../de/d13/sonicator__control_8h.html#ad0aeab8703f3a1439806186cba759315">sonicator_state_t</a> sonicator_update </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Main control update function. </p>
<p><b>CRITICAL</b>: Must be called at 1kHz (every 1ms) from main loop. Handles state machine transitions, safety monitoring, and telemetry updates.</p>
<p>Non-blocking execution guaranteed &lt;100μs typical.</p>
<dl class="section return"><dt>Returns</dt><dd>Current sonicator state after update </dd></dl>

</div>
</div>
<a id="ada89ba9b127e4beefebcf0437c3d3706" name="ada89ba9b127e4beefebcf0437c3d3706"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada89ba9b127e4beefebcf0437c3d3706">&#9670;&#160;</a></span>update_hardware_outputs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void update_hardware_outputs </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Update hardware outputs based on current state. </p>

</div>
</div>
<a name="doc-var-members" id="doc-var-members"></a><h2 id="header-doc-var-members" class="groupheader">Variable Documentation</h2>
<a id="ae51dbc7e8f836d942c158d75aa6e345b" name="ae51dbc7e8f836d942c158d75aa6e345b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae51dbc7e8f836d942c158d75aa6e345b">&#9670;&#160;</a></span>g_initialized</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool g_initialized = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ac1fd48a035e83d4c49c15569676b3428" name="ac1fd48a035e83d4c49c15569676b3428"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1fd48a035e83d4c49c15569676b3428">&#9670;&#160;</a></span>g_simulation_mode</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool g_simulation_mode = <a class="el" href="#a0b7077f739992ab6c25eb7d02c0899c6">SONICATOR_SIMULATION_MODE</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a2bc3fad78fedc5ae0e007a5cc4485108" name="a2bc3fad78fedc5ae0e007a5cc4485108"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2bc3fad78fedc5ae0e007a5cc4485108">&#9670;&#160;</a></span>g_sonicator</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../df/d70/structsonicator__state__control__t.html">sonicator_state_control_t</a> g_sonicator</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel static">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div>
<div class="line">    <a class="code hl_enumvalue" href="../../de/d13/sonicator__control_8h.html#ad0aeab8703f3a1439806186cba759315a02f13d1f0ad8e9fc52f93cf9c25ad0cf">SONICATOR_STATE_UNKNOWN</a>,  </div>
<div class="line">    <a class="code hl_enumvalue" href="../../de/d13/sonicator__control_8h.html#ad0aeab8703f3a1439806186cba759315a02f13d1f0ad8e9fc52f93cf9c25ad0cf">SONICATOR_STATE_UNKNOWN</a>,  </div>
<div class="line">    0,                        </div>
<div class="line">    <a class="code hl_define" href="../../de/d13/sonicator__control_8h.html#abe06b5505cf15123b31cf8b029b59679">SONICATOR_MIN_AMPLITUDE_PERCENT</a>, </div>
<div class="line">    <span class="keyword">false</span>,                    </div>
<div class="line">    <span class="keyword">false</span>,                    </div>
<div class="line">    <span class="keyword">false</span>,                    </div>
<div class="line">    <span class="keyword">false</span>,                    </div>
<div class="line">    <span class="keyword">false</span>,                    </div>
<div class="line">    <span class="keyword">false</span>,                    </div>
<div class="line">    0.0f,                     </div>
<div class="line">    0,                        </div>
<div class="line">    <a class="code hl_enumvalue" href="../../de/d13/sonicator__control_8h.html#a361c37dbeedf89f2fe09845eab7f0a99a45f67c744f0a84ef961991bbbcee8cb7">SONICATOR_FAULT_NONE</a>,     </div>
<div class="line">    0,                        </div>
<div class="line">    0,                        </div>
<div class="line">    0,                        </div>
<div class="line">    0,                        </div>
<div class="line">    <span class="keyword">false</span>,                    </div>
<div class="line">    0,                        </div>
<div class="line">    0,                        </div>
<div class="line">    0                         </div>
<div class="line">}</div>
<div class="ttc" id="asonicator__control_8h_html_a361c37dbeedf89f2fe09845eab7f0a99a45f67c744f0a84ef961991bbbcee8cb7"><div class="ttname"><a href="../../de/d13/sonicator__control_8h.html#a361c37dbeedf89f2fe09845eab7f0a99a45f67c744f0a84ef961991bbbcee8cb7">SONICATOR_FAULT_NONE</a></div><div class="ttdeci">@ SONICATOR_FAULT_NONE</div><div class="ttdef"><b>Definition</b> sonicator_control.h:68</div></div>
<div class="ttc" id="asonicator__control_8h_html_abe06b5505cf15123b31cf8b029b59679"><div class="ttname"><a href="../../de/d13/sonicator__control_8h.html#abe06b5505cf15123b31cf8b029b59679">SONICATOR_MIN_AMPLITUDE_PERCENT</a></div><div class="ttdeci">#define SONICATOR_MIN_AMPLITUDE_PERCENT</div><div class="ttdef"><b>Definition</b> sonicator_control.h:88</div></div>
<div class="ttc" id="asonicator__control_8h_html_ad0aeab8703f3a1439806186cba759315a02f13d1f0ad8e9fc52f93cf9c25ad0cf"><div class="ttname"><a href="../../de/d13/sonicator__control_8h.html#ad0aeab8703f3a1439806186cba759315a02f13d1f0ad8e9fc52f93cf9c25ad0cf">SONICATOR_STATE_UNKNOWN</a></div><div class="ttdeci">@ SONICATOR_STATE_UNKNOWN</div><div class="ttdef"><b>Definition</b> sonicator_control.h:50</div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="../../dir_ddb4d7e95cc2d6c8e1ade10a20d7247d.html">modules</a></li><li class="navelem"><a href="../../dir_0c4a6d34ece1d901881d58c52499c797.html">control</a></li><li class="navelem"><a href="../../d2/db9/sonicator_8cpp.html">sonicator.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
