<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Multi-Sonicator IO Firmware: Multi-Sonicator I/O Controller Documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Multi-Sonicator IO Firmware<span id="projectnumber">&#160;2.0.0</span>
   </div>
   <div id="projectbrief">Industrial automation controller for multi-unit sonicator control</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Multi-Sonicator I/O Controller Documentation </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1 class="doxsection"><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>The <b>Multi-Sonicator I/O Controller</b> is an industrial automation controller developed by Cannasol Technologies for simultaneous control of up to 4 CT2000 sonicators. This ATmega32A-based system provides seamless integration with existing Velocio PLC and HMI systems through MODBUS RTU communication, enabling precise multi-unit sonicator orchestration for industrial applications.</p>
<h1 class="doxsection"><a class="anchor" id="features"></a>
Key Features</h1>
<ul>
<li><b>Multi-Unit Control</b>: Simultaneous management of up to 4 CT2000 sonicators with coordinated operations</li>
<li><b>Industrial Integration</b>: Robust MODBUS RTU communication with existing automation infrastructure</li>
<li><b>DB9 Interface Topology</b>: Five dedicated DB9 connectors for external system integration</li>
<li><b>Safety Systems</b>: Comprehensive monitoring, alarm management, and emergency stop capabilities</li>
<li><b>Cloud Connectivity</b>: Firebase integration via ESP32 for remote monitoring and data logging</li>
<li><b>Hardware-in-the-Loop Testing</b>: Complete test harness for validation without production hardware</li>
<li><b>Web UI</b>: Modern web interface for monitoring, control, and testing operations</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="arch_sec"></a>
System Architecture</h1>
<h2 class="doxsection"><a class="anchor" id="hw_arch"></a>
Hardware Architecture</h2>
<p>The system centers around an ATmega32A microcontroller operating at 16MHz with the following key interfaces:</p>
<ul>
<li><b>DB9-0/DB9-5</b>: Main automation system communication (MODBUS RTU)</li>
<li><b>DB9-1 through DB9-4</b>: Individual sonicator control interfaces</li>
<li><b>Power</b>: 24VDC input with onboard regulation (12V/5V)</li>
<li><b>Programming</b>: Arduino-as-ISP interface for firmware updates</li>
</ul>
<p>Each sonicator interface provides:</p><ul>
<li>Start/Stop control signals</li>
<li>Amplitude control (0-100%)</li>
<li>Frequency monitoring and lock detection</li>
<li>Overload protection and reset</li>
<li>Power sense feedback</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="sw_arch"></a>
Software Architecture</h2>
<p>The firmware is organized into modular components for maintainability and extensibility:</p>
<ul>
<li><b>Communication Layer</b>: MODBUS RTU protocol implementation with register mapping</li>
<li><b>Control Layer</b>: Multi-unit sonicator coordination and state management</li>
<li><b>HAL (Hardware Abstraction Layer)</b>: Platform-independent hardware interface</li>
<li><b>Safety Layer</b>: Emergency stop, fault detection, and isolation mechanisms</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="quick_start"></a>
Quick Start Guide</h1>
<h2 class="doxsection"><a class="anchor" id="hw_setup"></a>
Hardware Setup</h2>
<ol type="1">
<li><b>Microcontroller</b>: ATmega32A with 16MHz external crystal</li>
<li><b>Programmer</b>: Arduino Uno R4 WiFi configured as ISP</li>
<li><b>Power Supply</b>: 24VDC from main automation system via DB9</li>
<li><b>Connections</b>: Wire DB9 connectors according to hardware configuration</li>
</ol>
<h2 class="doxsection"><a class="anchor" id="sw_setup"></a>
Software Development Setup</h2>
<ol type="1">
<li><b>Install PlatformIO</b> with VSCode extension</li>
<li><b>Clone Repository</b> and navigate to project directory</li>
<li><b>Install Dependencies</b>: <div class="fragment"><div class="line">make install-deps</div>
</div><!-- fragment --></li>
<li><b>Build Project</b>: <div class="fragment"><div class="line">make build</div>
</div><!-- fragment --></li>
<li><b>Upload Firmware</b>: <div class="fragment"><div class="line">make upload-to-device</div>
</div><!-- fragment --></li>
</ol>
<h2 class="doxsection"><a class="anchor" id="web_ui_setup"></a>
Web UI and Testing</h2>
<p>For development and testing with the web interface:</p>
<div class="fragment"><div class="line"># Install web dependencies</div>
<div class="line">make web-ui-install</div>
<div class="line"> </div>
<div class="line"># Start development servers</div>
<div class="line">make web-ui-dev</div>
<div class="line"> </div>
<div class="line"># Run tests with coverage</div>
<div class="line">make web-ui-test</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="modules_sec"></a>
Core Modules</h1>
<h2 class="doxsection"><a class="anchor" id="comm_mod"></a>
Communication Module</h2>
<p>Handles all MODBUS RTU communication with the main automation system:</p><ul>
<li>Register read/write operations</li>
<li>Protocol error handling</li>
<li>Response time optimization (&lt;100ms target)</li>
</ul>
<p><a class="el" href="dd/df5/modbus__register__manager_8h.html">modbus_register_manager.h</a> <a class="el" href="d4/d9a/modbus__registers_8h.html">modbus_registers.h</a></p>
<h2 class="doxsection"><a class="anchor" id="control_mod"></a>
Control Module</h2>
<p>Manages multi-unit sonicator coordination and individual unit control:</p><ul>
<li>Coordinated start/stop operations</li>
<li>Per-unit state management</li>
<li>Fault isolation and recovery</li>
<li>Amplitude and timing control</li>
</ul>
<p><a class="el" href="dc/dc2/_multiplexer_8h.html">Multiplexer.h</a> <a class="el" href="db/dac/_multi_sonicator_system_8h.html">MultiSonicatorSystem.h</a> <a class="el" href="dc/d4d/sonicator__modbus__bridge_8h.html">sonicator_modbus_bridge.h</a></p>
<h2 class="doxsection"><a class="anchor" id="hal_mod"></a>
Hardware Abstraction Layer</h2>
<p>Provides platform-independent hardware interface:</p><ul>
<li>GPIO management</li>
<li>Timer and PWM control</li>
<li>ADC operations</li>
<li>UART communication</li>
</ul>
<p><a class="el" href="d8/d4b/hal_8h.html">hal.h</a></p>
<h1 class="doxsection"><a class="anchor" id="config_sec"></a>
Configuration</h1>
<h2 class="doxsection"><a class="anchor" id="hw_config"></a>
Hardware Configuration</h2>
<p>The authoritative source for all hardware mappings and pin assignments: config/hardware-config.yaml</p>
<p>This file defines:</p><ul>
<li>DB9 connector pin mappings</li>
<li>ATmega32A pin assignments</li>
<li>Signal routing and connectivity</li>
<li>Test harness configurations</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="sw_config"></a>
Software Configuration</h2>
<p>Key configuration parameters defined in headers:</p><ul>
<li>MODBUS communication settings</li>
<li>Timing and timeout values</li>
<li>Safety thresholds and limits</li>
<li>System constants and constraints</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="safety_sec"></a>
Safety and Reliability</h1>
<p>The system implements multiple layers of safety protection:</p>
<ul>
<li><b>Emergency Stop</b>: Immediate shutdown capability across all units</li>
<li><b>Fault Detection</b>: Automatic detection of hardware faults and overloads</li>
<li><b>Isolation</b>: Faulty units isolated while others continue operation</li>
<li><b>Monitoring</b>: Continuous telemetry and status reporting</li>
<li><b>Reset Mechanisms</b>: Automatic and manual overload reset capabilities</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="testing_sec"></a>
Testing and Validation</h1>
<p>Comprehensive testing framework supporting multiple test levels:</p>
<ul>
<li><b>Unit Tests</b>: Individual component validation</li>
<li><b>Integration Tests</b>: Module interaction verification</li>
<li><b>Hardware-in-the-Loop (HIL)</b>: Full system testing with Arduino test harness</li>
<li><b>Acceptance Tests</b>: End-to-end behavioral validation</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="docs_sec"></a>
Documentation Navigation</h1>
<ul>
<li>Quick Start Guide</li>
<li>Development Environment Setup</li>
<li>Testing Framework Guide</li>
<li>Troubleshooting Guide</li>
<li>API Reference</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="standards_sec"></a>
Development Standards</h1>
<p>This project follows Agile Flow company standards:</p><ul>
<li>Coding Style Standards</li>
<li>Project Structure Standards</li>
<li>Software Testing Standards</li>
</ul>
<h1 class="doxsection"><a class="anchor" id="contact_sec"></a>
Contact and Support</h1>
<ul>
<li><b>Project Lead</b>: Stephen Boyett</li>
<li><b>Hardware Advisor</b>: Josh (CEO)</li>
<li><b>Company</b>: Cannasol Technologies</li>
<li><b>Repository</b>: <a href="https://github.com/cannasol-technologies/multi-sonicator-io">https://github.com/cannasol-technologies/multi-sonicator-io</a></li>
</ul>
<h1 class="doxsection"><a class="anchor" id="version_sec"></a>
Version Information</h1>
<ul>
<li><b>Current Version</b>: 2.0.0</li>
<li><b>Last Updated</b>: September 2025</li>
<li><b>Doxygen Documentation</b>: Auto-generated from source comments</li>
</ul>
<dl class="section author"><dt>Author</dt><dd>Stephen Boyett </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2025-09-17 </dd></dl>
<dl class="section version"><dt>Version</dt><dd>2.0.0 </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>2025 Cannasol Technologies. All rights reserved. </dd></dl>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
