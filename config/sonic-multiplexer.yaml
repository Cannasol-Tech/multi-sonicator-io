# Generated by Agile Flow™ Agentic Framework
# Multi-Sonicator-IO Master Configuration
# SOLE SOURCE OF TRUTH for complete system configuration

metadata:
  name: "sonic-multiplexer-master-config"
  description: "Master configuration file for Multi-Sonicator-IO system with modular YAML imports"
  author: "Stephen Boyett"
  company: "Cannasol Technologies"
  last_updated: "2025-09-16"
  version: "1.0.0"

# ============================================================================
# PROJECT INFORMATION
# ============================================================================

project:
  name: "multi-sonicator-io"
  description: "Sonicator Multiplexer - Hardware-in-the-Loop Testing and Production Control"
  version: "2.0.0"
  status: "MODULAR - Sole Source of Truth with separated concerns"
  architecture: "modular_yaml"
  
  # Project scope and capabilities
  scope:
    primary_function: "CT2000 sonicator multiplexed control via MODBUS RTU"
    secondary_function: "Hardware-in-the-Loop testing and validation"
    target_platform: "ATmega32A microcontroller"
    communication_protocol: "MODBUS RTU over RS-485"
    
  # Key stakeholders and contacts
  stakeholders:
    product_owner: "Cannasol Technologies"
    development_team: "Axovia AI"
    end_users: "Industrial automation systems"
    maintenance_team: "Field service technicians"

# ============================================================================
# MODULAR CONFIGURATION IMPORTS
# ============================================================================
# Each configuration aspect is separated into dedicated YAML files
# This provides better maintainability, version control, and team collaboration

configuration_modules:
  # Hardware pin assignments and microcontroller specifications
  pinout:
    file: "config/pinout-cfg.yaml"
    description: "ATmega32A pin assignments, port mappings, and hardware specifications"
    scope: "Hardware abstraction layer, GPIO definitions, ADC channels"
    last_updated: "2025-09-16"
    
  # DB9 connectors and test harness connection mappings
  connections:
    file: "config/connections-cfg.yaml"
    description: "DB9 connector pinouts, test harness connections, and cable specifications"
    scope: "Physical connections, connector standards, HIL test setup"
    last_updated: "2025-09-16"
    
  # MODBUS RTU and serial communication parameters
  communication:
    file: "config/communication-cfg.yaml"
    description: "MODBUS RTU settings, serial parameters, and communication protocols"
    scope: "Communication stack, protocol settings, performance parameters"
    last_updated: "2025-09-16"
    
  # CT2000 sonicator specifications and operational parameters
  sonicators:
    file: "config/sonicator-cfg.yaml"
    description: "CT2000 sonicator specifications, operational limits, and channel definitions"
    scope: "Sonicator control logic, safety parameters, operational modes"
    last_updated: "2025-09-16"

# ============================================================================
# SYSTEM ARCHITECTURE OVERVIEW
# ============================================================================

architecture:
  # System topology
  topology:
    description: "Multi-layer architecture with hardware abstraction"
    layers:
      - name: "Application Layer"
        description: "Sonicator control logic and business rules"
        components: ["Sonicator Bridge", "Control Algorithms", "Safety Logic"]
        
      - name: "Communication Layer"
        description: "MODBUS RTU protocol implementation"
        components: ["MODBUS Stack", "Register Manager", "CRC Validation"]
        
      - name: "Hardware Abstraction Layer"
        description: "Platform-independent hardware interface"
        components: ["GPIO HAL", "ADC HAL", "PWM HAL", "UART HAL", "Timer HAL"]
        
      - name: "Hardware Layer"
        description: "ATmega32A microcontroller and peripherals"
        components: ["ATmega32A", "DB9 Connectors", "Driver Circuits", "Isolation"]
  
  # Data flow architecture
  data_flow:
    control_path: "MODBUS → Register Manager → Sonicator Bridge → HAL → Hardware"
    status_path: "Hardware → HAL → Sonicator Bridge → Register Manager → MODBUS"
    safety_path: "Hardware → HAL → Safety Logic → Emergency Actions"
    
  # Key design patterns
  design_patterns:
    - "Hardware Abstraction Layer (HAL)"
    - "Factory Pattern (HAL implementations)"
    - "Observer Pattern (Status monitoring)"
    - "Command Pattern (Control operations)"
    - "Strategy Pattern (Communication protocols)"

# ============================================================================
# SYSTEM CAPABILITIES AND LIMITATIONS
# ============================================================================

capabilities:
  # Current system capabilities
  current:
    sonicator_channels: 4
    simultaneous_operation: 4
    modbus_communication: true
    individual_control: true
    shared_amplitude: true
    power_monitoring: true
    frequency_monitoring: true
    overload_protection: true
    emergency_stop: true
    
  # HIL testing capabilities
  testing:
    supported_channels: [4]  # Currently only Sonicator 4
    modbus_testing: true
    power_simulation: true
    frequency_simulation: true
    safety_testing: true
    automated_validation: true
    
  # Current limitations
  limitations:
    hil_harness: "Single-channel prototype (Sonicator 4 only)"
    unsupported_channels: [1, 2, 3]
    analog_range: "5V test harness vs 8.16V production"
    expansion_required: "Multi-channel harness for complete testing"

# ============================================================================
# ENVIRONMENT CONFIGURATION
# ============================================================================

environments:
  # Development environment
  development:
    description: "Local development with HIL test harness"
    hardware: "Arduino Uno R4 WiFi test harness"
    simulation_mode: false
    debug_logging: true
    test_harness_connected: true
    serial_port: "/dev/tty.usbmodem2101"
    
  # Testing environment
  testing:
    description: "Automated testing and validation"
    hardware: "HIL test harness with automation"
    simulation_mode: true
    debug_logging: true
    automated_testing: true
    performance_monitoring: true
    
  # Production environment
  production:
    description: "Industrial deployment with real CT2000 sonicators"
    hardware: "Production PCB with DB9 connectors"
    simulation_mode: false
    debug_logging: false
    safety_critical: true
    industrial_standards: true

# ============================================================================
# INTEGRATION AND COMPATIBILITY
# ============================================================================

integration:
  # External system interfaces
  external_systems:
    - name: "PLC/HMI Systems"
      interface: "MODBUS RTU"
      description: "Industrial automation system integration"
      
    - name: "CT2000 Sonicators"
      interface: "DB9 connectors"
      description: "Direct sonicator control and monitoring"
      
    - name: "Test Automation"
      interface: "Serial/USB"
      description: "Automated testing and validation"
      
  # Software compatibility
  software_stack:
    platform: "PlatformIO/Arduino"
    microcontroller: "ATmega32A"
    compiler: "AVR-GCC"
    frameworks: ["Arduino", "Native AVR"]
    
  # Hardware compatibility
  hardware_compatibility:
    microcontroller_family: "ATmega32A/ATmega328P"
    voltage_levels: "5V CMOS/TTL"
    communication: "RS-485/RS-232 compatible"
    connectors: "Standard DB9"

# ============================================================================
# QUALITY ASSURANCE AND VALIDATION
# ============================================================================

quality_assurance:
  # Testing requirements
  testing_requirements:
    unit_test_coverage: ">= 85%"
    integration_testing: "required"
    hil_testing: "required"
    performance_testing: "required"
    safety_testing: "required"
    
  # Validation criteria
  validation_criteria:
    modbus_response_time: "< 100ms (NFR2)"
    communication_reliability: "> 99.9%"
    safety_response_time: "< 50ms"
    power_measurement_accuracy: "+/- 2%"
    frequency_measurement_accuracy: "+/- 0.1%"
    
  # Compliance requirements
  compliance:
    industrial_standards: ["IEC 61131", "MODBUS Specification V1.1b3"]
    safety_standards: ["IEC 61508", "ISO 13849"]
    emc_standards: ["IEC 61000"]
    
# ============================================================================
# MAINTENANCE AND SUPPORT
# ============================================================================

maintenance:
  # Configuration management
  configuration_management:
    version_control: "Git with semantic versioning"
    change_approval: "Required for production changes"
    backup_strategy: "Automated daily backups"
    rollback_procedure: "Documented rollback process"
    
  # Documentation requirements
  documentation:
    technical_documentation: "Comprehensive API documentation"
    user_manuals: "Operator and maintenance manuals"
    troubleshooting_guides: "Fault diagnosis and resolution"
    change_logs: "Detailed change history"
    
  # Support procedures
  support:
    remote_diagnostics: "MODBUS-based system monitoring"
    local_diagnostics: "Built-in self-test capabilities"
    firmware_updates: "Field-upgradeable firmware"
    technical_support: "24/7 technical support available"

# ============================================================================
# MIGRATION AND LEGACY SUPPORT
# ============================================================================

migration:
  # Migration from monolithic configuration
  from_legacy:
    original_file: "config/hardware-config.yaml"
    migration_date: "2025-09-16"
    migration_reason: "Improved maintainability and modularity"
    migration_status: "Complete"
    
  # Backward compatibility
  backward_compatibility:
    legacy_support: "6 months"
    deprecation_warnings: "Enabled"
    migration_tools: "Automated configuration converter"
    
  # Future migration path
  future_migrations:
    database_config: "Planned for v3.0"
    cloud_integration: "Planned for v3.5"
    advanced_analytics: "Planned for v4.0"

# ============================================================================
# REFERENCES AND CROSS-REFERENCES
# ============================================================================

references:
  # Configuration files
  configuration_files:
    - "config/pinout-cfg.yaml - Hardware pin assignments"
    - "config/connections-cfg.yaml - Physical connections"
    - "config/communication-cfg.yaml - Communication settings"
    - "config/sonicator-cfg.yaml - Sonicator specifications"
    
  # Source code references
  source_code:
    - "include/register_map.h - MODBUS register definitions"
    - "include/system_config.h - System configuration constants"
    - "src/modules/hal/ - Hardware abstraction layer"
    - "src/modules/communication/ - MODBUS implementation"
    - "src/modules/control/ - Sonicator control logic"
    
  # Documentation references
  documentation:
    - "docs/prd/prd-v1.0.0.md - Product requirements document"
    - "docs/architecture/ - System architecture documentation"
    - "docs/sop/ - Standard operating procedures"
    - "test/acceptance/ - Acceptance test procedures"
    
  # External references
  external:
    - "MODBUS Application Protocol Specification V1.1b3"
    - "CT2000 User Manual and Specifications"
    - "ATmega32A Datasheet and Reference Manual"
    - "Industrial Communication Standards"

# ============================================================================
# CHANGE MANAGEMENT
# ============================================================================

change_management:
  # Update procedures
  update_procedures:
    configuration_changes: "Update individual module files"
    validation_required: "All changes must be validated"
    testing_required: "Regression testing for all changes"
    approval_required: "Technical lead approval for production"
    
  # Impact assessment
  impact_assessment:
    pinout_changes: "Requires hardware validation and HAL updates"
    connection_changes: "Requires connector and cable validation"
    communication_changes: "Requires protocol testing and validation"
    sonicator_changes: "Requires safety and operational validation"
    
  # Rollback procedures
  rollback_procedures:
    configuration_backup: "Automatic backup before changes"
    rollback_testing: "Validate rollback functionality"
    emergency_rollback: "Rapid rollback for critical issues"
    
# Version history and changelog
version_history:
  v2.0.0:
    date: "2025-09-16"
    changes: "Modular YAML architecture implementation"
    migration: "From monolithic hardware-config.yaml"
    
  v1.0.0:
    date: "2025-09-02"
    changes: "Initial monolithic configuration"
    file: "config/hardware-config.yaml (legacy)"
