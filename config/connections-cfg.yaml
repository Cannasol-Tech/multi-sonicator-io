# Generated by Agile Flow™ Agentic Framework
# Multi-Sonicator-IO Connections Configuration
# SOLE SOURCE OF TRUTH for DB9 connectors and test harness connections

metadata:
  name: "connections-configuration"
  description: "DB9 connector pinouts and test harness connection mappings"
  author: "Stephen Boyett"
  company: "Cannasol Technologies"
  last_updated: "2025-09-16"
  version: "1.0.0"



# ============================================================================
# DB9 CONNECTOR DEFINITIONS
# ============================================================================
# Each sonicator channel uses its own DB9 connector for CT2000 interface
# System communications use dedicated DB9 connectors
# Pin mapping standard: Pin1=OVERLOAD, Pin2=RESET, Pin3=FREQ_LOCK, 
#                      Pin4=FREQ÷10, Pin5=POWER, Pin7=START, Pin8=AMPLITUDE

db9_connectors:
  # System Communication Connectors
  DB9-0:
    description: "Primary system communications connector (MODBUS RTU network)"
    connector_type: "DB9 Male"
    function: "MODBUS RTU communication interface"
    location: "Main control panel"
    pins:
      8: 
        signal: "UART_RXD"
        dut_pin: "PD0"
        direction: "IN"
        function: "MODBUS RTU receive data"
        electrical: "RS-485 compatible, 115200 baud"
      9: 
        signal: "UART_TXD"
        dut_pin: "PD1"
        direction: "OUT"
        function: "MODBUS RTU transmit data"
        electrical: "RS-485 compatible, 115200 baud"
    unused_pins: [1, 2, 3, 4, 5, 6, 7]
    cable_requirements: "Shielded twisted pair, RS-485 rated"

  DB9-5:
    description: "CT-IAS-001 Main Automation Box (MODBUS RTU alternate)"
    connector_type: "DB9 Male"
    function: "Panel-alternate connector for MODBUS RTU"
    location: "Automation panel interface"
    note: "Mirrors DB9-0 pinout for redundant connection capability"
    pins:
      8: 
        signal: "UART_RXD"
        dut_pin: "PD0"
        direction: "IN"
        function: "MODBUS RTU receive data (mirrored)"
        electrical: "RS-485 compatible, 115200 baud"
      9: 
        signal: "UART_TXD"
        dut_pin: "PD1"
        direction: "OUT"
        function: "MODBUS RTU transmit data (mirrored)"
        electrical: "RS-485 compatible, 115200 baud"
    unused_pins: [1, 2, 3, 4, 5, 6, 7]
    cable_requirements: "Shielded twisted pair, RS-485 rated"

  # Sonicator Interface Connectors
  DB9-1:
    description: "CT2000 Sonicator 1 interface connector"
    connector_type: "DB9 Female"
    function: "Complete sonicator control and monitoring interface"
    location: "Sonicator 1 control panel"
    sonicator_id: 1
    pins:
      1: 
        signal: "OVERLOAD_1"
        dut_pin: "PD6"
        direction: "IN"
        function: "Overload detection from CT2000"
        electrical: "Opto-isolated, 5V logic"
        modbus_register: "REG_SON1_STATUS_FLAGS bit 1"
      2: 
        signal: "RESET_1"
        dut_pin: "PC7"
        direction: "OUT"
        function: "Overload reset command to CT2000"
        electrical: "Open-collector, ULN2003A driver"
        modbus_register: "REG_SON1_OVERLOAD_RESET"
      3: 
        signal: "FREQ_LOCK_1"
        dut_pin: "PB7"
        direction: "IN"
        function: "Frequency lock status from CT2000"
        electrical: "Opto-isolated, 5V logic"
        modbus_register: "REG_SON1_STATUS_FLAGS bit 2"
      4: 
        signal: "FREQ_DIV10_1"
        dut_pin: "PB3"
        direction: "IN"
        function: "Frequency ÷10 signal from CT2000"
        electrical: "5V logic, frequency counter input"
        modbus_register: "REG_SON1_FREQ_DIV10_HZ"
      5: 
        signal: "POWER_SENSE_1"
        dut_pin: "PA4"
        direction: "ANALOG"
        function: "Power level analog signal from CT2000"
        electrical: "0-8.16V analog, 5.44mV/W scaling"
        modbus_register: "REG_SON1_POWER_RAW_ADC"
      7: 
        signal: "START_1"
        dut_pin: "PC6"
        direction: "OUT"
        function: "Start/Stop control to CT2000"
        electrical: "Open-collector, ULN2003A driver"
        modbus_register: "REG_SON1_START_STOP"
      8: 
        signal: "AMPLITUDE_ALL"
        dut_pin: "PD7"
        direction: "OUT"
        function: "Amplitude control (shared with all sonicators)"
        electrical: "0-10V PWM output"
        modbus_register: "REG_SON1_AMPLITUDE_SP"
    unused_pins: [6, 9]
    status: "not_connected"  # Current prototype limitation
    cable_requirements: "Multi-conductor shielded cable, analog/digital rated"

  DB9-2:
    description: "CT2000 Sonicator 2 interface connector"
    connector_type: "DB9 Female"
    function: "Complete sonicator control and monitoring interface"
    location: "Sonicator 2 control panel"
    sonicator_id: 2
    pins:
      1: 
        signal: "OVERLOAD_2"
        dut_pin: "PD5"
        direction: "IN"
        function: "Overload detection from CT2000"
        electrical: "Opto-isolated, 5V logic"
        modbus_register: "REG_SON2_STATUS_FLAGS bit 1"
      2: 
        signal: "RESET_2"
        dut_pin: "PC5"
        direction: "OUT"
        function: "Overload reset command to CT2000"
        electrical: "Open-collector, ULN2003A driver"
        modbus_register: "REG_SON2_OVERLOAD_RESET"
      3: 
        signal: "FREQ_LOCK_2"
        dut_pin: "PB6"
        direction: "IN"
        function: "Frequency lock status from CT2000"
        electrical: "Opto-isolated, 5V logic"
        modbus_register: "REG_SON2_STATUS_FLAGS bit 2"
      4: 
        signal: "FREQ_DIV10_2"
        dut_pin: "PB2"
        direction: "IN"
        function: "Frequency ÷10 signal from CT2000"
        electrical: "5V logic, frequency counter input"
        modbus_register: "REG_SON2_FREQ_DIV10_HZ"
      5: 
        signal: "POWER_SENSE_2"
        dut_pin: "PA5"
        direction: "ANALOG"
        function: "Power level analog signal from CT2000"
        electrical: "0-8.16V analog, 5.44mV/W scaling"
        modbus_register: "REG_SON2_POWER_RAW_ADC"
      7: 
        signal: "START_2"
        dut_pin: "PC4"
        direction: "OUT"
        function: "Start/Stop control to CT2000"
        electrical: "Open-collector, ULN2003A driver"
        modbus_register: "REG_SON2_START_STOP"
      8: 
        signal: "AMPLITUDE_ALL"
        dut_pin: "PD7"
        direction: "OUT"
        function: "Amplitude control (shared with all sonicators)"
        electrical: "0-10V PWM output"
        modbus_register: "REG_SON2_AMPLITUDE_SP"
    unused_pins: [6, 9]
    status: "not_connected"  # Current prototype limitation
    cable_requirements: "Multi-conductor shielded cable, analog/digital rated"

  DB9-3:
    description: "CT2000 Sonicator 3 interface connector"
    connector_type: "DB9 Female"
    function: "Complete sonicator control and monitoring interface"
    location: "Sonicator 3 control panel"
    sonicator_id: 3
    pins:
      1: 
        signal: "OVERLOAD_3"
        dut_pin: "PD4"
        direction: "IN"
        function: "Overload detection from CT2000"
        electrical: "Opto-isolated, 5V logic"
        modbus_register: "REG_SON3_STATUS_FLAGS bit 1"
      2: 
        signal: "RESET_3"
        dut_pin: "PC3"
        direction: "OUT"
        function: "Overload reset command to CT2000"
        electrical: "Open-collector, ULN2003A driver"
        modbus_register: "REG_SON3_OVERLOAD_RESET"
      3: 
        signal: "FREQ_LOCK_3"
        dut_pin: "PB5"
        direction: "IN"
        function: "Frequency lock status from CT2000"
        electrical: "Opto-isolated, 5V logic"
        modbus_register: "REG_SON3_STATUS_FLAGS bit 2"
      4: 
        signal: "FREQ_DIV10_3"
        dut_pin: "PB1"
        direction: "IN"
        function: "Frequency ÷10 signal from CT2000"
        electrical: "5V logic, frequency counter input"
        modbus_register: "REG_SON3_FREQ_DIV10_HZ"
      5: 
        signal: "POWER_SENSE_3"
        dut_pin: "PA6"
        direction: "ANALOG"
        function: "Power level analog signal from CT2000"
        electrical: "0-8.16V analog, 5.44mV/W scaling"
        modbus_register: "REG_SON3_POWER_RAW_ADC"
      7: 
        signal: "START_3"
        dut_pin: "PC2"
        direction: "OUT"
        function: "Start/Stop control to CT2000"
        electrical: "Open-collector, ULN2003A driver"
        modbus_register: "REG_SON3_START_STOP"
      8: 
        signal: "AMPLITUDE_ALL"
        dut_pin: "PD7"
        direction: "OUT"
        function: "Amplitude control (shared with all sonicators)"
        electrical: "0-10V PWM output"
        modbus_register: "REG_SON3_AMPLITUDE_SP"
    unused_pins: [6, 9]
    status: "not_connected"  # Current prototype limitation
    cable_requirements: "Multi-conductor shielded cable, analog/digital rated"

  DB9-4:
    description: "CT2000 Sonicator 4 interface connector (fully connected in current prototype)"
    connector_type: "DB9 Female"
    function: "Complete sonicator control and monitoring interface"
    location: "Sonicator 4 control panel"
    sonicator_id: 4
    pins:
      1: 
        signal: "OVERLOAD_4"
        dut_pin: "PD3"
        direction: "IN"
        function: "Overload detection from CT2000"
        electrical: "Opto-isolated, 5V logic"
        modbus_register: "REG_SON4_STATUS_FLAGS bit 1"
      2: 
        signal: "RESET_4"
        dut_pin: "PC1"
        direction: "OUT"
        function: "Overload reset command to CT2000"
        electrical: "Open-collector, ULN2003A driver"
        modbus_register: "REG_SON4_OVERLOAD_RESET"
      3: 
        signal: "FREQ_LOCK_4"
        dut_pin: "PB4"
        direction: "IN"
        function: "Frequency lock status from CT2000"
        electrical: "Opto-isolated, 5V logic"
        modbus_register: "REG_SON4_STATUS_FLAGS bit 2"
      4: 
        signal: "FREQ_DIV10_4"
        dut_pin: "PB0"
        direction: "IN"
        function: "Frequency ÷10 signal from CT2000"
        electrical: "5V logic, frequency counter input"
        modbus_register: "REG_SON4_FREQ_DIV10_HZ"
      5: 
        signal: "POWER_SENSE_4"
        dut_pin: "PA7"
        direction: "ANALOG"
        function: "Power level analog signal from CT2000"
        electrical: "0-8.16V analog, 5.44mV/W scaling"
        modbus_register: "REG_SON4_POWER_RAW_ADC"
      7: 
        signal: "START_4"
        dut_pin: "PC0"
        direction: "OUT"
        function: "Start/Stop control to CT2000"
        electrical: "Open-collector, ULN2003A driver"
        modbus_register: "REG_SON4_START_STOP"
      8: 
        signal: "AMPLITUDE_ALL"
        dut_pin: "PD7"
        direction: "OUT"
        function: "Amplitude control (shared with all sonicators)"
        electrical: "0-10V PWM output"
        modbus_register: "REG_SON4_AMPLITUDE_SP"
    unused_pins: [6, 9]
    status: "connected"  # Fully connected in current prototype
    cable_requirements: "Multi-conductor shielded cable, analog/digital rated"

# ============================================================================
# TEST HARNESS CONNECTIONS (Arduino Uno R4 WiFi)
# ============================================================================
# Hardware-in-the-Loop test harness for development and validation

test_harness:
  type: "Arduino Uno R4 WiFi"
  microcontroller: "ATmega328P"
  clock_frequency: 16000000  # 16MHz
  voltage: 5.0
  description: "Single-channel HIL harness for Sonicator 4 testing"
  
  # Current prototype connections (Sonicator 4 only)
  connections:
    # MODBUS Communication Interface
    D2: 
      dut_pin: "PD0"
      signal: "UART_RXD"
      direction: "harness_to_dut"
      function: "MODBUS RTU communication test"
      electrical: "5V logic, 115200 baud"
      
    D3: 
      dut_pin: "PD1"
      signal: "UART_TXD"
      direction: "dut_to_harness"
      function: "MODBUS RTU communication test"
      electrical: "5V logic, 115200 baud"
    
    # System Status Monitoring
    D4: 
      dut_pin: "PD2"
      signal: "STATUS_LED"
      direction: "dut_to_harness"
      function: "System status monitoring"
      electrical: "5V logic, LED driver"
    
    # Sonicator 4 Interface (Fully Connected)
    D7: 
      dut_pin: "PB0"
      signal: "FREQ_DIV10_4"
      direction: "harness_to_dut"
      sonicator: 4
      function: "Frequency ÷10 signal simulation"
      electrical: "5V logic, frequency generator"
      
    D8: 
      dut_pin: "PB4"
      signal: "FREQ_LOCK_4"
      direction: "harness_to_dut"
      sonicator: 4
      function: "Frequency lock status simulation"
      electrical: "5V logic, digital output"
      
    A2: 
      dut_pin: "PD3"
      signal: "OVERLOAD_4"
      direction: "harness_to_dut"
      sonicator: 4
      function: "Overload condition simulation"
      electrical: "5V logic, digital output"
      
    A3: 
      dut_pin: "PC0"
      signal: "START_4"
      direction: "dut_to_harness"
      sonicator: 4
      function: "Start/Stop command monitoring"
      electrical: "5V logic, digital input"
      
    A4: 
      dut_pin: "PC1"
      signal: "RESET_4"
      direction: "dut_to_harness"
      sonicator: 4
      function: "Reset command monitoring"
      electrical: "5V logic, digital input"
      
    A1: 
      dut_pin: "PA7"
      signal: "POWER_SENSE_4"
      direction: "dut_to_harness"
      sonicator: 4
      function: "Power level simulation"
      electrical: "0-5V analog, PWM simulation"
      
    D9: 
      dut_pin: "PD7"
      signal: "AMPLITUDE_ALL"
      direction: "dut_to_harness"
      function: "Amplitude control monitoring"
      electrical: "5V PWM, amplitude measurement"

  # Test capabilities and limitations
  capabilities:
    supported_channels: [4]
    unsupported_channels: [1, 2, 3]
    modbus_testing: true
    power_simulation: true
    frequency_simulation: true
    safety_testing: true
    
  limitations:
    current_prototype: "Single-channel HIL harness"
    expansion_required: "Channels 1-3 require additional harness connections"
    analog_range: "Limited to 5V (vs 8.16V CT2000 output)"
    
  expansion_plan:
    description: "4-channel harness expansion for complete system testing"
    additional_hardware: "Arduino Mega 2560 or custom PCB"
    estimated_pins_required: 28  # 7 pins per sonicator × 4 sonicators

# Connection validation and testing
validation:
  electrical_tests:
    - "Continuity testing for all connections"
    - "Isolation testing for opto-isolated signals"
    - "Voltage level verification (5V logic)"
    - "Signal integrity testing at 115200 baud"
    
  functional_tests:
    - "MODBUS communication validation"
    - "Sonicator control command verification"
    - "Status signal monitoring accuracy"
    - "Power measurement calibration"
    - "Frequency measurement accuracy"
    
  safety_tests:
    - "Emergency stop functionality"
    - "Overload detection response"
    - "Isolation barrier integrity"
    - "Fault condition handling"

# Cable specifications and requirements
cable_specifications:
  modbus_cable:
    type: "Shielded twisted pair"
    impedance: "120 ohm characteristic"
    length_max: "1000 meters"
    connector: "DB9 male/female"
    
  sonicator_cable:
    type: "Multi-conductor shielded"
    conductors: 8
    gauge: "18 AWG minimum"
    length_max: "50 meters"
    connector: "DB9 female"
    
  test_harness_cable:
    type: "Ribbon cable or individual wires"
    length: "1-2 meters"
    connector: "Dupont or similar"

# References and cross-references
references:
  pinout_config: "config/pinout-cfg.yaml"
  communication_config: "config/communication-cfg.yaml"
  sonicator_config: "config/sonicator-cfg.yaml"
  hardware_schematics: "docs/hardware/schematics/"
  test_procedures: "test/acceptance/README.md"

# Change management
change_management:
  update_requirements:
    - "Update test harness wiring diagrams"
    - "Update connector pinout documentation"
    - "Update cable assembly specifications"
    - "Validate against hardware schematics"
    - "Update HIL test procedures"
    
  validation_checklist:
    - "Verify DB9 pinout consistency"
    - "Confirm test harness pin assignments"
    - "Validate electrical specifications"
    - "Check cable length limitations"
    - "Verify connector gender specifications"
