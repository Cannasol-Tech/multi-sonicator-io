# Generated by Agile Flow™ Agentic Framework
# Multi-Sonicator-IO Pinout Configuration
# SOLE SOURCE OF TRUTH for ATmega32A pin assignments

# ============================================================================
# FILE PURPOSE AND SCOPE
# ============================================================================
# This YAML configuration file serves as the definitive reference for all
# ATmega32A microcontroller pin assignments in the Multi-Sonicator-IO system.
# It defines the complete pin matrix, signal routing, MODBUS register mappings,
# and hardware interface specifications for controlling up to 4 CT2000 sonicators.
#
# CRITICAL: This file is the single source of truth for pin assignments.
# All code generation, hardware validation, and system integration must
# reference this configuration to ensure consistency across the entire system.
# ============================================================================

metadata:
  name: "pinout-configuration"
  description: "ATmega32A DIP-40 pin assignments for Multi-Sonicator-IO"
  author: "Stephen Boyett"
  company: "Cannasol Technologies"
  last_updated: "2025-09-16"
  version: "1.0.0"

# ============================================================================
# DEVICE UNDER TEST (DUT) SPECIFICATIONS
# ============================================================================
# Defines the target microcontroller specifications and operating parameters.
# These settings drive code generation for GPIO initialization, clock setup,
# and peripheral configuration throughout the embedded firmware.
# ============================================================================
dut:
  microcontroller:
    type: "ATmega32A-PU"           # Microchip ATmega32A in DIP-40 package
    package: "DIP-40"              # 40-pin dual in-line package for breadboard compatibility
    clock_frequency: 16000000      # 16MHz external crystal oscillator
    voltage: 5.0                   # 5V operating voltage for industrial compatibility
    manufacturer: "Microchip"      # Formerly Atmel, now Microchip Technology

  # ==========================================================================
  # COMPLETE PIN MATRIX WITH PORT/PIN MAPPING
  # ==========================================================================
  # This section defines every used pin on the ATmega32A with complete
  # signal routing, MODBUS register mappings, and hardware interface details.
  # Pin assignments are organized by PORT (B, C, D, A) for logical grouping
  # and efficient GPIO port manipulation in the embedded firmware.
  # ==========================================================================
  pins:
    # ========================================================================
    # PORT B - Frequency Input Monitoring (Physical Pins 1-8)
    # ========================================================================
    # PORT B handles all frequency-related input signals from the 4 sonicators.
    # Each sonicator provides both a divided frequency signal (÷10 for MCU
    # compatibility) and a frequency lock status signal. These signals are
    # critical for real-time monitoring of sonicator operational status.
    # 
    # Hardware Interface: Opto-isolated inputs for electrical isolation and
    # noise immunity. Frequency signals are pre-divided by 10 in hardware
    # to keep input frequencies within MCU timer/counter capabilities.
    # ========================================================================
    
    PB0:
      pin: 1                                    # Physical DIP-40 pin number
      signal: "FREQ_DIV10_4"                   # Hardware signal name
      direction: "IN"                          # Input pin configuration
      sonicator: 4                             # Associated with sonicator unit 4
      function: "Frequency ÷10 input from CT2000 Sonicator 4"
      modbus_register: "REG_SON4_FREQ_DIV10_HZ"  # MODBUS register name
      modbus_address: "0x0171"                 # MODBUS register address (hex)
      scale_notes: "÷10 frequency (S4) - stored as Hz÷10 for efficiency"
      test_point: "TBD"                        # Hardware test point designation

    PB1:
      pin: 2                                    # Physical DIP-40 pin number
      signal: "FREQ_DIV10_3"                   # Hardware signal name
      direction: "IN"                          # Input pin configuration
      sonicator: 3                             # Associated with sonicator unit 3
      function: "Frequency ÷10 input from CT2000 Sonicator 3"
      modbus_register: "REG_SON3_FREQ_DIV10_HZ"  # MODBUS register name
      modbus_address: "0x0151"                 # MODBUS register address (hex)
      scale_notes: "÷10 frequency (S3) - stored as Hz÷10 for efficiency"
      test_point: "N/A"                        # No dedicated test point

    PB2:
      pin: 3                                    # Physical DIP-40 pin number
      signal: "FREQ_DIV10_2"                   # Hardware signal name
      direction: "IN"                          # Input pin configuration
      sonicator: 2                             # Associated with sonicator unit 2
      function: "Frequency ÷10 input from CT2000 Sonicator 2"
      modbus_register: "REG_SON2_FREQ_DIV10_HZ"  # MODBUS register name
      modbus_address: "0x0131"                 # MODBUS register address (hex)
      scale_notes: "÷10 frequency (S2) - stored as Hz÷10 for efficiency"
      test_point: "N/A"                        # No dedicated test point

    PB3:
      pin: 4                                    # Physical DIP-40 pin number
      signal: "FREQ_DIV10_1"                   # Hardware signal name
      direction: "IN"                          # Input pin configuration
      sonicator: 1                             # Associated with sonicator unit 1
      function: "Frequency ÷10 input from CT2000 Sonicator 1"
      modbus_register: "REG_SON1_FREQ_DIV10_HZ"  # MODBUS register name
      modbus_address: "0x0111"                 # MODBUS register address (hex)
      scale_notes: "÷10 frequency (S1) - stored as Hz÷10 for efficiency"
      test_point: "TBD"                        # Hardware test point designation

    PB4:
      pin: 5                                    # Physical DIP-40 pin number
      signal: "FREQ_LOCK_4"                    # Hardware signal name
      direction: "IN"                          # Input pin configuration
      sonicator: 4                             # Associated with sonicator unit 4
      function: "Frequency lock status from CT2000 Sonicator 4"
      modbus_register: "REG_SON4_STATUS_FLAGS" # MODBUS register name
      modbus_address: "0x0172"                 # MODBUS register address (hex)
      modbus_bit: 2                            # Specific bit within register
      scale_notes: "FLCK_4 via opto-isolator"  # Hardware implementation notes
      test_point: "TBD"                        # Hardware test point designation

    PB5:
      pin: 6                                    # Physical DIP-40 pin number
      signal: "FREQ_LOCK_3"                    # Hardware signal name
      direction: "IN"                          # Input pin configuration
      sonicator: 3                             # Associated with sonicator unit 3
      function: "Frequency lock status from CT2000 Sonicator 3"
      modbus_register: "REG_SON3_STATUS_FLAGS" # MODBUS register name
      modbus_address: "0x0152"                 # MODBUS register address (hex)
      modbus_bit: 2                            # Specific bit within register
      scale_notes: "FLCK_3 via opto-isolator"  # Hardware implementation notes
      test_point: "N/A"                        # No dedicated test point

    PB6:
      pin: 7                                    # Physical DIP-40 pin number
      signal: "FREQ_LOCK_2"                    # Hardware signal name
      direction: "IN"                          # Input pin configuration
      sonicator: 2                             # Associated with sonicator unit 2
      function: "Frequency lock status from CT2000 Sonicator 2"
      modbus_register: "REG_SON2_STATUS_FLAGS" # MODBUS register name
      modbus_address: "0x0132"                 # MODBUS register address (hex)
      modbus_bit: 2                            # Specific bit within register
      scale_notes: "FLCK_2 via opto-isolator"  # Hardware implementation notes
      test_point: "N/A"                        # No dedicated test point

    PB7:
      pin: 8                                    # Physical DIP-40 pin number
      signal: "FREQ_LOCK_1"                    # Hardware signal name
      direction: "IN"                          # Input pin configuration
      sonicator: 1                             # Associated with sonicator unit 1
      function: "Frequency lock status from CT2000 Sonicator 1"
      modbus_register: "REG_SON1_STATUS_FLAGS" # MODBUS register name
      modbus_address: "0x0112"                 # MODBUS register address (hex)
      modbus_bit: 2                            # Specific bit within register
      scale_notes: "FLCK_1 via opto-isolator"  # Hardware implementation notes
      test_point: "TBD"                        # Hardware test point designation

    # ========================================================================
    # PORT C - Control Output Signals (Physical Pins 22-29)
    # ========================================================================
    # PORT C provides all digital control outputs to the 4 sonicators.
    # Each sonicator requires both START/STOP control and OVERLOAD RESET
    # capability. These are critical control signals that must be reliable
    # and electrically isolated from the microcontroller.
    #
    # Hardware Interface: ULN2003A Darlington transistor arrays provide
    # open-collector drive capability with sufficient current handling for
    # sonicator control inputs. This provides electrical isolation and
    # protection for the microcontroller outputs.
    # ========================================================================
    
    PC0:
      pin: 22                                   # Physical DIP-40 pin number
      signal: "START_4"                        # Hardware signal name
      direction: "OUT"                         # Output pin configuration
      sonicator: 4                             # Associated with sonicator unit 4
      function: "Start/Stop control output to CT2000 Sonicator 4"
      modbus_register: "REG_SON4_START_STOP"   # MODBUS register name
      modbus_address: "0x0160"                 # MODBUS register address (hex)
      scale_notes: "ULN2003A open-collector driver"  # Hardware driver details
      test_point: "TBD"                        # Hardware test point designation

    PC1:
      pin: 23                                   # Physical DIP-40 pin number
      signal: "RESET_4"                        # Hardware signal name
      direction: "OUT"                         # Output pin configuration
      sonicator: 4                             # Associated with sonicator unit 4
      function: "Overload reset control output to CT2000 Sonicator 4"
      modbus_register: "REG_SON4_OVERLOAD_RESET"  # MODBUS register name
      modbus_address: "0x0162"                 # MODBUS register address (hex)
      scale_notes: "ULN2003A open-collector driver"  # Hardware driver details
      test_point: "TBD"                        # Hardware test point designation

    PC2:
      pin: 24                                   # Physical DIP-40 pin number
      signal: "START_3"                        # Hardware signal name
      direction: "OUT"                         # Output pin configuration
      sonicator: 3                             # Associated with sonicator unit 3
      function: "Start/Stop control output to CT2000 Sonicator 3"
      modbus_register: "REG_SON3_START_STOP"   # MODBUS register name
      modbus_address: "0x0140"                 # MODBUS register address (hex)
      scale_notes: "ULN2003A open-collector driver"  # Hardware driver details
      test_point: "N/A"                        # No dedicated test point

    PC3:
      pin: 25                                   # Physical DIP-40 pin number
      signal: "RESET_3"                        # Hardware signal name
      direction: "OUT"                         # Output pin configuration
      sonicator: 3                             # Associated with sonicator unit 3
      function: "Overload reset control output to CT2000 Sonicator 3"
      modbus_register: "REG_SON3_OVERLOAD_RESET"  # MODBUS register name
      modbus_address: "0x0142"                 # MODBUS register address (hex)
      scale_notes: "ULN2003A open-collector driver"  # Hardware driver details
      test_point: "N/A"                        # No dedicated test point

    PC4:
      pin: 26                                   # Physical DIP-40 pin number
      signal: "START_2"                        # Hardware signal name
      direction: "OUT"                         # Output pin configuration
      sonicator: 2                             # Associated with sonicator unit 2
      function: "Start/Stop control output to CT2000 Sonicator 2"
      modbus_register: "REG_SON2_START_STOP"   # MODBUS register name
      modbus_address: "0x0120"                 # MODBUS register address (hex)
      scale_notes: "ULN2003A open-collector driver"  # Hardware driver details
      test_point: "N/A"                        # No dedicated test point

    PC5:
      pin: 27                                   # Physical DIP-40 pin number
      signal: "RESET_2"                        # Hardware signal name
      direction: "OUT"                         # Output pin configuration
      sonicator: 2                             # Associated with sonicator unit 2
      function: "Overload reset control output to CT2000 Sonicator 2"
      modbus_register: "REG_SON2_OVERLOAD_RESET"  # MODBUS register name
      modbus_address: "0x0122"                 # MODBUS register address (hex)
      scale_notes: "ULN2003A open-collector driver"  # Hardware driver details
      test_point: "N/A"                        # No dedicated test point

    PC6:
      pin: 28                                   # Physical DIP-40 pin number
      signal: "START_1"                        # Hardware signal name
      direction: "OUT"                         
